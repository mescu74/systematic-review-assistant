# MPH SR Prototype Technology Stack Specification

## Technology Choices

| Category                       | Technology                              | Version / Details                               | Description / Purpose                                                                                  | Justification                                                                                |
| :----------------------------- | :-------------------------------------- | :---------------------------------------------- | :----------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------- |
| **Languages**                  | Python                                  | 3.12                                            | Primary language for application logic and UI.                                                         | Existing project language, well-suited for AI/ML tasks and Streamlit.                        |
| **Runtime**                    | Python Interpreter                      | 3.12                                            | Execution environment for the application.                                                             | Matches language version.                                                                    |
| **Frameworks**                 | Streamlit                               | (From `pyproject.toml`, latest stable)          | Frontend UI framework.                                                                                 | Existing framework for the UI.                                                               |
|                                | SQLModel                                | (From `pyproject.toml`, latest stable)          | ORM for database interaction, bridging SQLAlchemy and Pydantic.                                        | Existing ORM.                                                                                |
|                                | SQLAlchemy                              | (From `pyproject.toml`, used by SQLModel)       | Core ORM capabilities used by SQLModel.                                                                | Dependency of SQLModel.                                                                      |
|                                | LangChain                               | (From `pyproject.toml`, latest stable)          | Framework for LLM agent and chain development.                                                         | Existing framework for LLM orchestration.                                                    |
|                                | LangGraph                               | (From `pyproject.toml`, latest stable)          | Library for building stateful, multi-actor applications with LLMs.                                     | Leveraged by existing parts of the agent system.                                             |
|                                | Pydantic                                | (From `pyproject.toml`)                         | Data validation, settings management, and used by SQLModel/LangChain.                                  | Core for data validation and schemas.                                                        |
| **Databases**                  | PostgreSQL                              | 15.x (via Supabase)                             | Primary relational data store.                                                                         | Existing database provider, robust and scalable.                                             |
|                                | └─ `pgvector` extension                 | (Version deployed with Supabase PostgreSQL)     | Enables vector similarity search for embedding-based deduplication.                                    | Essential for planned semantic duplicate detection.                                          |
|                                | (Future) `pgvectorscale`                | N/A                                             | Potential future enhancement for `pgvector` for improved performance and features like filtered search. | Offers advanced indexing ([GitHub](https://github.com/timescale/pgvectorscale)).             |
| **Cloud Platform (Current)**   | Supabase                                | N/A                                             | Provides hosted PostgreSQL and potentially other BaaS features for DB.                                 | Existing cloud service for the database.                                                     |
| **Cloud Platform (Future)**    | Streamlit Community Cloud               | N/A                                             | Intended future hosting platform for the Streamlit application.                                        | Common and convenient hosting for Streamlit apps.                                            |
| **Cloud Services**             | Supabase PostgreSQL                     | 15.x                                            | Hosted PostgreSQL database service for prototype and integration testing.                             | Existing database service.                                                                   |
| **LLM APIs**                   | OpenAI API                              | N/A                                             | Provides LLMs (e.g., current target `gpt-4o`) for Conservative/Comprehensive screening agents (via `langchain-openai`).  | Chosen for initial screening agents due to strong general capabilities.                      |
|                                | Google AI API (Vertex AI or Gemini API) | N/A                                             | Provides LLMs (e.g., current target `gemini-1.5-pro-preview-0514`) for the Conflict Resolver agent (via `langchain-google-genai`). | Chosen for resolver agent due to advanced reasoning capabilities.                            |
| **API Clients & Integrations** | BioPython (`Bio.Entrez`)                | (From `pyproject.toml`)                         | For interacting with NCBI Entrez E-utilities (PubMed search and fetch).                                | Standard library for NCBI interactions.                                                      |
|                                | `langchain-openai`                      | (From `pyproject.toml`)                         | LangChain integration package for OpenAI models.                                                       | Provides necessary classes (`ChatOpenAI`) for interacting with OpenAI LLMs within LangChain. |
|                                | `langchain-google-genai`                | (From `pyproject.toml`)                         | LangChain integration package for Google Gemini models.                                                | Provides necessary classes for interacting with Google AI Gemini models within LangChain.    |
| **Testing**                    | Pytest                                  | (From `pyproject.toml`)                         | Framework for unit and integration tests.                                                              | Existing testing framework.                                                                  |
|                                | Hypothesis                              | (From `pyproject.toml`)                         | Property-based testing library to enhance robustness of schemas and utilities.                         | Finds edge cases, good for data validation logic.                                            |
| **Migrations**                 | Alembic                                 | (From `pyproject.toml`)                         | Database schema migration tool.                                                                        | Existing tool for database migrations.                                                       |
| **Linting/Static Analysis**    | Ruff                                    | (From `pyproject.toml`)                         | Linter and formatter for Python code.                                                                  | Fast and comprehensive, specified in project setup.                                          |
|                                | Pyright                                 | (Version as dev dependency in `pyproject.toml`) | Static type checker for Python.                                                                        | Enhances code quality and catches type errors.                                               |
| **Logging & Observability**    | Loguru                                  | (From `pyproject.toml`)                         | Flexible logging framework.                                                                            | Existing logging setup.                                                                      |
|                                | LangSmith SDK                           | `langsmith>=0.3.6` (From `pyproject.toml`)      | Python client library for LangSmith platform for LLM application debugging, tracing, and monitoring.   | Provides crucial observability into LLM chain and agent behavior.                            |
|                                | LogFire                                 | (From `pyproject.toml`)                         | Observability platform, integrates with Loguru and OpenTelemetry.                                      | Enhances observability and tracing capabilities.                                             |
| **Package Management**         | `uv`                                    | (Version from `Makefile` or system)             | Python packaging and virtual environment management.                                                   | Project's chosen package manager for speed and modern features.                              |

**Notes:**

- Specific versions for other libraries (Streamlit, SQLModel, LangChain, etc.) are as defined in the `pyproject.toml` file. It's assumed these are reasonably up-to-date or will be updated to recent stable versions as part of the recovery if necessary and does not introduce breaking changes conflicting with the recovery scope.
- The `SearchService` will encapsulate PubMed API interactions using `Bio.Entrez`.
- The legacy code in `src/sr_assistant/step1/` and `src/sr_assistant/step2/` is not part of this technology stack for the recovered application.
- The `src/sr_assistant/app/pubmed_integration.py` file's parsing logic will be reviewed and integrated into `SearchService` as appropriate, or the file will be removed if its functionality is fully superseded by logic within `SearchService`.

## Change Log

| Change          | Date       | Version | Description             | Author          |
|-----------------|------------|---------|-------------------------|-----------------|
| Initial Draft   | 2025-05-09 | 0.1     | Initial draft.          | Architect Agent |
| Consistency Update | 2025-05-10 | 0.2     | Added Hypothesis, pgvector. Clarified LLM targets. Updated `sra_integration_test` DB name for cloud services. | Architect Agent |
| Review & Confirm | 2025-05-10 | 0.3     | Reviewed against detailed architectural plans; tech stack confirmed to be consistent. | Architect Agent |
