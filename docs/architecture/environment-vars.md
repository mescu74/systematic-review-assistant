# Environment Variables

This document lists the environment variables used by the Systematic Review Assistant (SRA) application. These variables are crucial for configuring database connections, API keys for external services (LLMs, NCBI), observability platforms, and application behavior.

It is essential to manage these variables securely and appropriately for different environments (development, testing, CI, production/deployment).

## Usage

These variables are typically loaded from `.env` files (e.g., `.env`, `.env.local`, `.env.test`) using a library like `python-dotenv` during application startup and for test configurations. Refer to the example files (`.env.example`, etc.) in the repository root for templates.

## Variable Definitions

| Variable Name                        | Purpose                                                                                    | Required | Example Value / Format                                                      | Notes / Used In                                      |
|--------------------------------------|--------------------------------------------------------------------------------------------|----------|-----------------------------------------------------------------------------|------------------------------------------------------|
| **Supabase & Database Connection**   |                                                                                            |          |                                                                             |                                                      |
| `SRA_SUPABASE_URL`                   | URL for the Supabase project.                                                              | Yes      | `https://[project_ref].supabase.co`                                         | Supabase client initialization                         |
| `SRA_SUPABASE_ANON_KEY`              | Anonymous key for the Supabase project (public, for client-side access).                   | Yes      | `eyJhGxxxxxxxx...` (long JWT-like string)                                   | Supabase client initialization (frontend if used directly) |
| `SRA_SUPABASE_SERVICE_ROLE_KEY`    | Service role key for Supabase (secret, for backend admin-level access).                  | Yes      | `eyJhGyyyyyyyy...` (long JWT-like string)                                   | Backend services requiring admin rights on Supabase    |
| `SRA_SUPABASE_PASSWORD`              | Password for the Supabase `postgres` user.                                                 | Yes      | `your_complex_password`                                                     | Used in the connection strings below                 |
| `SRA_SUPABASE_DIRECT_URL`            | Direct PostgreSQL connection string via Supabase pooler (typically port 5432 for pooler).  | Yes      | `postgresql://postgres.[PROJECT_REF]:[USER_PASSWORD]@[POOLER_HOST]:5432/postgres` | Direct DB access, potentially for admin tasks or specific tools. `[POOLER_HOST]` is e.g., `aws-0-region.pooler.supabase.com` |
| `SRA_DATABASE_URL`                   | Primary PostgreSQL connection string for the **prototype** database, via Supabase pooler (SQLAlchemy with Psycopg). | Yes      | `postgresql+psycopg://postgres.[PROJECT_REF]:[USER_PASSWORD]@[POOLER_HOST]:5432/postgres` | Main App ORM (`.env`, `.env.local`)                  |
| `SRA_DATABASE_URL_PSQL`              | Standard PostgreSQL connection string for the **prototype** database, via Supabase pooler.     | Yes      | `postgresql://postgres.[PROJECT_REF]:[USER_PASSWORD]@[POOLER_HOST]:5432/postgres` | Alternative to `SRA_DATABASE_URL` for tools expecting standard scheme. |
| `TEST_DATABASE_URL`                  | PostgreSQL connection string for the **integration test** database, via Supabase pooler.   | Yes      | `postgresql://postgres.[PROJECT_REF]:[USER_PASSWORD]@[POOLER_HOST]:5432/sra_integration_test` | Testing (`.env.test`, CI)                            |
| `SRA_SUPABASE_REF`                   | Reference ID for the Supabase project (e.g., `yzqmbbfmijdclfwqucuu`).                        | Yes      | `[project_ref_from_supabase_dashboard]`                                     | Part of Supabase URLs and hostnames                    |
|                                      |                                                                                            |          |                                                                             |                                                      |
| **LLM API Keys**                     |                                                                                            |          |                                                                   |                                                      |
| `OPENAI_API_KEY`                     | API key for accessing OpenAI models.                                                       | Yes      | `sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`             | LLM Agents (Screening, Resolver)                     |
| `ANTHROPIC_API_KEY`                  | API key for accessing Anthropic models.                                                  | Optional | `sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`          | If Anthropic models are used                         |
| `GOOGLE_API_KEY`                     | API key for accessing Google AI models (e.g., Gemini).                                     | Optional | `AIxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`                   | LLM Agents (Resolver, if used)                       |
|                                      |                                                                                            |          |                                                                   |                                                      |
| **NCBI PubMed API**                  |                                                                                            |          |                                                                   |                                                      |
| `NCBI_EMAIL`                         | Your email address for making requests to NCBI Entrez (PubMed).                            | Yes      | `your.email@example.com`                                          | `SearchService` (PubMed searches)                    |
| `NCBI_API_KEY`                       | Your API key for NCBI Entrez (provides higher rate limits).                              | Optional | `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`                      | `SearchService` (PubMed searches)                    |
|                                      |                                                                                            |          |                                                                   |                                                      |
| **LangSmith (LLM Observability)**    |                                                                                            |          |                                                                   |                                                      |
| `LANGSMITH_API_KEY`                  | API key for LangSmith (ensure this is the correct name vs. `LANGCHAIN_API_KEY`).           | Yes      | `ls__xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`                          | LangChain LLM calls                                  |
| `LANGCHAIN_TRACING_V2`               | Enables LangSmith v2 tracing (set to "true").                                            | Yes      | `true`                                                            | LangChain configuration                              |
| `LANGSMITH_TRACING`                  | (Alternative/Older way to enable tracing, verify if still used alongside `LANGCHAIN_TRACING_V2`) | Optional | `true`                                                            | LangChain configuration                              |
| `LANGSMITH_ENDPOINT`                 | LangSmith API endpoint.                                                                    | Optional | `https://api.smith.langchain.com`                               | LangChain configuration                              |
| `LANGSMITH_PROJECT`                  | LangSmith project name. **Use specific values for environments.**                          | Yes      | Prototype: `"sra:proto"`, Test: `"sra:proto:test"`              | LangChain configuration                              |
|                                      |                                                                                            |          |                                                                   |                                                      |
| **LogFire (Application Observability)**|                                                                                            |          |                                                                   |                                                      |
| `LOGFIRE_TOKEN`                      | Token for LogFire (if using direct token-based auth).                                      | Optional | `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`                              | Loguru/LogFire integration                           |
| `OTEL_EXPORTER_OTLP_HEADERS`         | Headers for OTLP exporter, used by LogFire if token is part of headers.                  | Optional | `Authorization=Bearer YOUR_LOGFIRE_TOKEN_OR_INGESTION_KEY`      | OpenTelemetry/LogFire integration                    |
| `OTEL_SERVICE_NAME`                  | Service name for OpenTelemetry.                                                          | Optional | `sra-prototype`                                                   | OpenTelemetry/LogFire integration                    |
|                                      |                                                                                            |          |                                                                   |                                                      |
| **Application Behavior / LLM Models**|                                                                                            |          |                                                                   |                                                      |
| `SRA_SCREENING_MODEL_CONSERVATIVE`   | Specifies the LLM for the conservative screening reviewer.                                 | Optional | `gpt-4o`                                                          | `screening_agents.py`                                |
| `SRA_SCREENING_MODEL_COMPREHENSIVE`  | Specifies the LLM for the comprehensive screening reviewer.                                | Optional | `gpt-4o`                                                          | `screening_agents.py`                                |
| `SRA_RESOLVER_MODEL`                 | Specifies the LLM for the conflict resolver.                                               | Optional | `gemini-1.5-pro-preview-0514` (or `gpt-4o`)                   | `screening_agents.py` (resolver)                     |
| `SRA_SUGGESTION_AGENT_MODEL`         | Specifies the LLM for the PICO suggestion agent.                                         | Optional | `gpt-4o`                                                          | `protocol.py` / `suggestion_agent.py`                |
|                                      |                                                                                            |          |                                                                   |                                                      |
| **Deployment/Environment Stage**     |                                                                                            |          |                                                                   |                                                      |
| `ENVIRONMENT`                        | Specifies the current operating environment.                                               | Optional | `development`, `test`, `staging`, `production`                    | General application logic, logging configuration     |
| `SRA_ENV`                            | (Alternative/Specific environment variable, clarify if redundant with `ENVIRONMENT`)       | Optional | `dev`, `test`, `prod`                                             | Application logic                                    |
|                                      |                                                                                            |          |                                                                   |                                                      |
| **Miscellaneous**                    |                                                                                            |          |                                                                   |                                                      |
| `LOG_LEVEL`                          | Application-wide logging level for Loguru.                                                 | Optional | `INFO` (e.g., DEBUG, INFO, WARNING, ERROR, CRITICAL)              | Logging configuration                                |

## Notes

- **Security:** API keys and database credentials (passwords, service_role_key) should be treated as secrets and managed appropriately (e.g., using GitHub secrets for CI, Doppler, HashiCorp Vault, or similar tools for deployed environments). They should **never** be hardcoded into the source code or committed to version control (even in `.env` files if the repo is public).
- **`.env` Files:** For local development, variables are typically placed in `.env` (for common dev vars), `.env.local` (for local overrides, gitignored), and `.env.test` (for testing configurations, also gitignored). Ensure `.env.example` files are kept up-to-date with all non-secret variables.
- **CI/CD:** In GitHub Actions (see `.github/workflows/pr.yml`), secrets are injected into the environment from GitHub repository secrets.
- **Defaults:** Some application behavior variables (like LLM model names or `LOG_LEVEL`) might have hardcoded defaults in the application code if the environment variable is not set. This document lists them for awareness and potential override capability.
- **Specificity:** Where specific values are known for different environments (like `LANGSMITH_PROJECT`), they are explicitly noted.

## Change Log

| Change          | Date       | Version | Description             | Author          |
|-----------------|------------|---------|-------------------------|-----------------|
| Initial Draft   | 2025-05-12 | 0.1     | First draft based on initial understanding. | Architect Agent |
| Major Revision  | 2025-05-12 | 0.2     | Significantly revised and expanded based on user-provided `.env` contents. Added Supabase vars, clarified DB URLs, LangSmith project values, and other missing variables. | Architect Agent |
| Actual URL Fix  | 2025-05-12 | 0.3     | Updated Supabase connection string examples to reflect actual project structure (all via pooler on port 5432, specific hostnames) based on `.env` inspection. | Architect Agent |
